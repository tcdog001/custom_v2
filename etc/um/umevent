#!/bin/bash

um_init() {
	#
	# todo
	# 1. init global iptable
	# 2. init global ipset
	#
	echo "init $@"
}

um_fini() {
	#
	# todo
	# 
	# 1. clear global iptable
	# 2. clear global ipset 
	#
	echo "fini $@"
}

um_bind() {
	local argc=$#
	local mac="$1"
	local ip="$2"

	if ((2!=argc)); then
		return 1
	fi

	#
	# todo
	# 1. move ip to ipset 'unauth'
	# 1. set tc default
	# 2. set nginx default
	#
	echo "bind $@"
}

um_unbind() {
	local argc=$#
	local mac="$1"
	local ip="$2"

	if ((2!=argc)); then
		reutrn 1
	fi
	
	#
	# todo
	# 1. move ip to ipset 'unauth'
	# 2. set tc default
	# 3. set nginx default
	#
	echo "unbind $@"
}

um_auth() {
	local argc=$#
	local mac="$1"
	local ip="$2"; shift 2
	local json="$*"

	if ((argc<3)); then
		return 1
	fi
	
	#
	# todo
	# 1. move ip to ipset 'auth'
	# 2. set tc by json
	# 3. set nginx by json
	#
	echo "auth $@"
}

um_deauth() {
	local argc=$#
	local mac="$1"
	local ip="$2"
	local reason="$3"

	if ((3!=argc)); then
		return 1
	fi

	#
	# todo
	# 1. move ip to ipset 'unauth'
	# 2. set tc default
	# 3. set nginx default
	# 4. update website reason
	#
	echo "deauth $@"
}

main() {
	local action="$1"; shift

	case ${action} in
	init|fini|bind|unbind|auth|deauth)
		um_${action} "$@"
		;;
	*)
		return 1
		;;
	esac
}

main "$@"
